format_version: 3
environments:
  generic:
    environment_variables:
      DOCKER_TAG: latest
      DOCKER_NO_CACHE: false
      DOCKER_BUILD_LOCAL: true
      #DOCKER_REG: docker.io
      #DOCKER_REGISTRY: docker.io
      #FROM_IMG_REGISTRY: docker.io
      #UCP_USER: test123
      #DOCKER_REGISTRY_INSECURE: true
    pipelines:
      - cv-cuda92
      - cv-cudnn92
      - cv-nccl92
pipelines:
  cv-cuda92:
    group: cuda-9.2
    template: DockerBuild
    label_template: ${COUNT}
    lock_behavior: none
    environment_variables:
      DOCKER_FILE: Dockerfile.bionic.9-2
    materials:
      git:
        git: https://github.com/qnib/uplain-cuda
        shallow_clone: false
        auto_update: true
        branch: master
        destination: docker
      cv-bazel-dev:
        pipeline: cv-bazel-dev
        stage: DockerBuild
        name: cv-bazel-dev
  cv-cudnn92:
    group: cuda-9.2
    template: DockerBuild
    label_template: ${COUNT}
    lock_behavior: none
    environment_variables:
      DOCKER_FILE: Dockerfile.9-2
    materials:
      git:
        git: https://github.com/qnib/uplain-cudnn
        shallow_clone: false
        auto_update: true
        branch: master
        destination: docker
      cv-cuda92:
        pipeline: cv-cuda92
        stage: DockerBuild
        name: cv-cuda92
  cv-nccl92:
    group: cuda-9.2
    template: DockerBuild
    label_template: ${COUNT}
    lock_behavior: none
    environment_variables:
      DOCKER_FILE: Dockerfile.9.2
      DBUILD_CFLAG_MARCH: x86-64
    materials:
      git:
        git: https://github.com/qnib/uplain-nccl
        shallow_clone: false
        auto_update: true
        branch: master
        destination: docker
      cv-cudnn92:
        pipeline: cv-cudnn92
        stage: DockerBuild
        name: cv-cudnn92
